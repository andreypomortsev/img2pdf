# Сервис для конвертации изображений в PDF

Безопасный веб-сервис, который конвертирует изображения в PDF-файлы и объединяет несколько PDF в один документ. Включает аутентификацию JWT, бэкенд на FastAPI и Celery для асинхронной обработки задач, все работает в Docker-контейнерах.

## Возможности

- **Аутентификация JWT**: Безопасный доступ ко всем эндпоинтам с использованием токенов
- **Управление пользователями**: Регистрация и управление учетными записями с безопасным хешированием паролей
- **Асинхронная конвертация изображений в PDF**: Загрузите изображение, и оно будет преобразовано в PDF в фоновом режиме
- **Асинхронное объединение PDF**: Объединяйте несколько PDF-файлов в один документ
- **Отслеживание статуса задач**: Следите за состоянием любой фоновой задачи (конвертация или объединение)
- **Контейнеризация**: Весь стек приложения управляется с помощью Docker и Docker Compose для легкой настройки и развертывания
- **Всестороннее тестирование**: Включает модульные и интеграционные тесты с высоким покрытием

## Технологический стек

- **Бэкенд**: FastAPI
- **Аутентификация**: JWT (JSON Web Tokens)
- **Асинхронные задачи**: Celery
- **Брокер сообщений**: Redis
- **База данных**: PostgreSQL с SQLAlchemy ORM
- **Обработка изображений**: Pillow, img2pdf
- **Манипуляции с PDF**: pypdf
- **Безопасность**: Passlib, OAuth2 с паролем (и хешированием)
- **Тестирование**: Pytest, HTTPX
- **Контейнеризация**: Docker, Docker Compose

## Начало работы

### Требования

- Docker
- Docker Compose

### Запуск приложения

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/andreypomortsev/img2pdf.git
    cd img2pdf
    ```

2.  **Соберите и запустите сервисы:**
    ```bash
    docker compose up --build -d
    ```

3.  Приложение будет запущено и доступно по адресу `http://localhost:8000`.

## Аутентификация

### Зарегистрировать нового пользователя
- **URL**: `/api/v1/auth/register`
- **Метод**: `POST`
- **Тело запроса**:
  ```json
  {
    "email": "пользователь@пример.com",
    "password": "ваш-надежный-пароль"
  }
  ```
- **Успешный ответ**:
  ```json
  {
    "email": "пользователь@пример.com",
    "id": 1,
    "is_active": true
  }
  ```

### Войти в систему
- **URL**: `/api/v1/auth/login`
- **Метод**: `POST`
- **Тело запроса**:
  ```json
  {
    "username": "пользователь@пример.com",
    "password": "ваш-надежный-пароль"
  }
  ```
- **Успешный ответ**:
  ```json
  {
    "access_token": "ваш-jwt-токен",
    "token_type": "bearer"
  }
  ```

## Документация API

Все перечисленные ниже эндпоинты требуют аутентификации. Укажите JWT-токен в заголовке `Authorization`:
```
Authorization: Bearer ваш-jwt-токен
```

### Файлы

#### Загрузить изображение
- **URL**: `/api/v1/files/upload-image/`
- **Метод**: `POST`
- **Заголовки**: `Authorization: Bearer <токен>`
- **Данные формы**: `file` (изображение для конвертации)
- **Успешный ответ**:
  ```json
  {
    "task_id": "<ваш-id-задачи>",
    "status": "PENDING"
  }
  ```

#### Проверить статус задачи
- **URL**: `/api/v1/files/tasks/{task_id}`
- **Метод**: `GET`
- **Заголовки**: `Authorization: Bearer <токен>`
- **Успешный ответ**:
  ```json
  {
    "task_id": "<ваш-id-задачи>",
    "task_status": "SUCCESS",
    "task_result": "static/files/ваш_файл.pdf"
  }
  ```

### Операции с PDF

#### Объединить PDF
- **URL**: `/api/v1/pdfs/merge/`
- **Метод**: `POST`
- **Заголовки**: `Authorization: Bearer <токен>`
- **Тело запроса**:
  ```json
  {
    "file_ids": [1, 2],
    "output_filename": "объединенный.pdf"
  }
  ```
- **Успешный ответ**:
  ```json
  {
    "task_id": "<ваш-id-задачи>",
    "status": "PENDING"
  }
  ```

## Лицензия

Этот проект лицензирован под лицензией MIT - подробности см. в файле [LICENSE](LICENSE).
